# HNSCC_Survival
Data Preprocessing and analysis for Head and Neck Squamous Cell Carcinoma using Keras

ANN has the options to run headless from the command line, and the random resampling attribute can be toggled

## Data Source: 
https://wiki.cancerimagingarchive.net/display/Public/HNSCC
Grossberg A, Mohamed A, Elhalawani H, Bennett W, Smith K, Nolan T, Williams B, Chamchod S, Heukelom J, Kantor M, Browne T, Hutcheson K, Gunn G, Garden A, Morrison W, Frank S, R osenthal D, Freymann J, Fuller C. 
(2018) Imaging and Clinical Data Archive for Head and Neck Squamous Cell Carcinoma Patients Treated with Radiotherapy. 
Scientific Data 5 :180173 (2018) 
DOI: 10.1038/sdata.2018.173 

Survival Prediction for Head and Neck Squamous Cell Carcinoma Using Artificial Neural Networks

## Contributions:
> The first contribution for this project is data preprocessing of clinical data from The Cancer Imaging Archive. The image data is publicly available for use, and is based on a clinical trial. The data preprocessing involved feature selection and categorical encoding in order to convert from excel spreadsheet data to a pandas DataFrame format, which could be more easily processed by a Neural Network. The second contribution is the architecture for the Artificial Neural Network (ANN) to create a classifier for expected survival time, which was built using the TensorFlow library. 
## Abstract (Executive Summary):
> Head and Neck Squamous Cell Carcinoma (HNSCC) is the seventh most common cancer in the world, and it is a type of cancer that affects the mouth, nose, and throat. Recent studies indicate that the expected 5-year survival rate is affected by various clinical features, including age, gender, tobacco use, and HPV status. The goal of this study is to use clinical data to create a classifier that is able to predict the survival of patients with HNSCC using an Artificial Neural Network, which is a type of deep learning methodology. The data used was from a clinical trial for Chemoraditherapy (n = 215), and it is publicly available through The Cancer Imaging Archive, and it has an emphasis on body composition. The data was preprocessed, then used to train the ANN using an illness-based survival censor. Additionally, the data set was augmented using random resampling, which aids in the correct classification of patients in minority survival categories. This study demonstrates that an ANN can be constructed to perform with an F1 score of 0.741, and that upsampling is a valid way to achieve the goal.</p>
## Background Information:
> Head and Neck Squamous Cell Carcinoma (HNSCC) is the seventh most common cancer in the world, and it is a type of cancer that affects the mouth, nose, and throat. HNSCC is a subtype that accounts for 90% of all cancers affecting the head and neck region. The cancer can interfere with the patient’s daily functioning and reduce their quality of life by causing pain, redness, and swelling. It can also metastasize, which spreads the cancerous cells to other parts of the body and can result in death[1]. 
>The 5 year survival rate of HNSCC is 40-50%, but each patient has a different set of clinical features that correlate with different survival outcomes. For example, a history of tobacco use has been shown to correlate with a worse prognosis than the lack of such history and the presence of human papilloma virus (HPV). Therefore, in order to determine the correct prognosis for a patient, it is necessary to consider a selection of clinical data that includes both information about the cancer and information about the patient. Cancer related features include the size and location of the tumor, and patient features include age, sex, weight, and height. However, not all clinical features are expected to provide the same amount of information in determining the prognosis of the patient. Some features may be more important than others, and some some unexplored attributes may be able to aid in the prediction of the 5 year survival rate. In addition, there are many treatment options available, and the survival of the patient is also affected by the treatments they undergo. Some treatments include surgery and concurrent chemo-radiotherapy (CCRT), which is administered with different doses for different durations and is prescribed by a doctor[2].
> When patients are diagnosed with cancer, one of the main questions they want answered is how long they can expect to live. High risk patients may want to pursue a more aggressive treatment strategy than low risk patients. Although each patient is unique, they may expect to have similar outcomes to patients with similar clinical features. Therefore, it is important to study a large number of patients when determining how clinical features affect survival rates.
> One way to interpret how data is correlated with a binary outcome is to use Artificial Neural Networks (ANNs). ANNs function similarly to the way the human brain works, since they correlate a large amount of complex input information with an output based on learned experience. Given a dataset containing information about a large range of patients, an ANN can be trained to predict the 5 year survival rate. Multiple neural networks that are trained on the same datasets with different categories of clinical data can be compared to demonstrate what the best categories are.
## Research Problem:
> The primary research problem of this paper is to demonstrate that clinical features can be used to predict the 5 year survival rate of patients with Head and Neck Squamous Cell Carcinoma. The clinical features were chosen from publicly available clinical datasets from The Cancer Imaging Archive. The dataset contained the clinical data and treatment information of 215 patients [3] who have a diagnosis of HNSCC, as well as labeled ground truth survival data that is censored based on whether the patient survived or whether the cause of death is attributed to HNSCC, a different kind of cancer cancer, or unrelated to cancer. This paper also evaluates how randomly resampling minority classes can be used to create more robust models.
## Literature Review:
> One paper by Chen et. al discusses the impact of clinical feature selection on the performance of neural networks. Especially in the problem space of genetic sequencing, there are a thousands of features (genes) and a relatively small number of patients. As a result, it can be nearly impossible to tell how a given gene affects the observable features in the patient. In addition, it takes a significant amount of computational resources to train a neural network, so it is important to make sure that most of the time is spent on training with features that are more likely to have an effect on the prediction task at hand. Their work demonstrates that feature selection is a way to improve the predictive power of neural networks[4].
> A study by Forghani et. al uses machine learning to predict the metastasis of HNSCC by analyzing the texture of images obtained from CT scans. Unlike this paper, there was more of a focus on imaging technology rather than clinical data, and the prediction task was related to metastasis rather than survival. The model received an accuracy score of 88% for the test set, which demonstrates how deep learning can be used to interpret information about HNSCC from image data [5].
> One of the most common statistical methods for evaluating how different variables affect the total expected survival time is the Cox Proportional Hazards Model. Cox regression uses a hazard function that is used to determine a risk function. The overall risk is evaluated based on the covariates and the individual impact of each covariate. Currently, cox regression is the standard method of evaluating how certain factors contribute to the risk of a particular outcome over an amount of time, which is used in both the medical field and in risk management [6]. One model that directly compares deep learning with the cox proportional hazards model using a combination of clinical features and image data was able to achieve an accuracy score of 88%, which was higher than the cox hazards score of 80% accuracy [7].
> Oropharyngeal Squamous Cell Carcinoma (OSCC) is a subtype of HNSCC that is located in the  oropharynx region of the mouth and throat. OSCC can be caused in several different ways, including a strand of HPV. A deep learning model was able to stratify patients with OSCC into two categories and predict their HPV status. According to the results, OSCC associated with HPV has a better prognosis than OSCC associated with tobacco and alcohol use. While the model created by Klein et. al predicts the HPV status based on the CT image, this paper uses HPV status to predict the survival score. Either way, the results demonstrate that HPV status is an important clinical feature to consider when creating a model for HNSCC [8].
> Although there is evidence that shows how smoking history has a negative impact on the survival rates of HNSCC, the exact cause of the relationship remains unknown. A study published to the Journal of the Sciences and Specialties of the Head and Neck suggests that patients who develop HNSCC who do not have a history of tobacco and alcohol use are different demographics than the patients who do have a history of substance use. Some of the correlated attributes include age and gender. Therefore, when considering how smoking history contributes to the outcome of the disease, it is also important to keep in mind the affect that the correlated demographic traits may have on HNSCC progression. In addition, the population of smokers makes up the vast majority (n = 1829 smokers and n = 183 nonsmokers) of the population in the study, However, the study did not find a statistically significant difference in the 4-year follow up survival rate when substance use was the only difference in the populations. However, there was still a noticeable difference when considering other factors such as tumor location. This evidence suggests that the best approach to determining the 5-year survival rate is found in using a wide variety of clinical features, since there are many factors that may overlap with each other to determine the overall survival time [9].	
## Proposed Algorithms:
> The goal of this paper is to create and describe an artificial neural network (ANN) that is able to predict the survival rate of patients diagnosed with HNSCC. The process works by utilizing a combination of activation functions, a loss function, and backpropogation in order to create a program that takes a series of inputs (in the form of various clinical features) to output a binary classification of expected 5 year survival.
> The first layer of the network are inputs to the function, and they are represented in a quantifiable, numerical form. This is fairly straightforward for values such as age, height, weight, and tumor radius, which are in the form of integer or decimal values. However, there are several other clinical features to be explored such as sex, smoking history, and treatment types, which were represented in the clinical data documentation as strings, which are also known as categorical features. One necessary preprocessing step before entering the data into the neural network is to transform the categories into a numerical format, which was accomplished using the one-hot encoding of so-called “dummy variables”. For example, for biological sex, there were to categories of male and female, and the substitute values were designated as 1 or 0, which transfers the same categorical information in a format that the ANN can process. Similar processing techniques were used to process information related to treatment options such as the specific chemotherapy regimen and surgeries performed, although some attributes such as radiation dosage were already in a numerical form, so no preprocessing needed to be done for those attributes.
> The subsequent layers are composed of a series of perceptrons or nodes that create an evaluation based on input from each node in the previous layer. For example, each of m nodes in the second layer receives input from the output of each of n node in the previous layer, and it also contains a series of n weights, which are combined in a linear combination to result in a scalar valued output. Next, the scalar is transformed to a restricted domain between 0 and 1 using an activation function, which is sigmoid(x). This results in internal calculations that are proportional to each other. If there are m nodes in the ith layer, then there are m inputs for each node in the i+1th layer, and so on for each layer in the network.
> The final layer of the network has a more specialized task, which is to return a value that represents the final prediction. Since this network is a binary classifier, the layer is one node that outputs a 1 or 0, where 0 represents survival and 1 represents death. The entire network is evaluated based on the output of the final layer by using a binary cross-entropy loss function, which is  specialized for binary classification tasks. The loss function is higher when it misclassifies a set of values and lower when it correctly classifies values. The ground truth is a disease-specific survival censor that was provided in the original dataset. 
> There are three discrete partitions of data that are used in the process of training a machine learning model: training, validation, and testing. Training is a process whereby the loss function is reduced over time by adjusting each of the w weights for each layer of the network in order to produce a value that matches with the labeled, ground truth training data in a process known as backpropogation. Validation is a process where the trained model is evaluated on unseen data to estimate how well the model is improving over the course of training. After training, the model is then tested on new data that it hasn’t seen during the training phase, and it is used to assess how well the model is able to generalize to unknown scenarios. 
> Machine learning algorithms need to have high quality, diverse data in large amounts in order to create a good model, so it is important for the training set to be the largest partition. Additionally, it is important to consider the fact that the training set does not necessarily represent the entirety of all cases of HNSCC, so the model should be constructed in a way that avoids overfitting to the training data. Overfitting can be noticed when there is high variance between the training and validation loss functions during training, or when the model produces poor results when presented with the testing data. One way to prevent overfitting is to stop training when the curves begin to diverge. Other methods include using fewer layers in the ANN, or collecting more data. Since there may be a class imbalance in binary classification problems, one class of outcomes may be severely underrepresented in the training set, so the model has fewer opportunities to learn from the trends. One method to overcome class imbalance and add more training data is to resample data from minority classes in a process called random resampling, where some data points in the training set are duplicated. This method has been shown to result in better-trained models that produce more accurate results for minority classes, with minimal overfitting [10].
## Implementation and Results:
> The model was constructed with one input layer, two hidden layers, and one output layer. The hidden layers had the same number of nodes as the number of inputs, and there was one node in the output layer. There was also a way to train the model with or without random resampling. The algorithm produces a confusion matrix, which shows the actual and predicted label of each item in the test set. Additional metrics are precision, recall, sensitivity, specificity, and F1 score.
## Advantages and Drawbacks:
> One advantage to the choice of the data set by this study is that it makes use of the attributes of body composition before and after treatment in order to create the classifier, which is not a factor in many existing datasets. Therefore, this paper demonstrates both the ability of ANNs and the validity of body composition as a predictor for survival outcome. Some of the clinical features provided in the data, such as cancer stage, were not included as a training attribute. Since the stage is based upon the doctor’s assumptions about the progression of the disease, which is more qualitative and based on several hidden characteristics that the model did not have access to. Including the stage as a feature would likely improve the performance, although it does not necessarily demonstrate how well the other features would perform. The same argument that stage should not be used as a trainable attribute could apply to the specific treatment option, since more severe cancer would be prescribed a more intense treatment plan by a doctor. However, since the goal of treatment is to improve survival outcomes, the treatment itself is an important factor that affects the survival. Additionally, patients with similar attributes are not necessarily prescribed the same treatment. Because the solution used is an ANN, the covariates do not necessarily have to be independent.
> Random resampling enables the model to make better predictions. However, there are some disadvantages because the examples are determined stochastically. As a result, the specific values for the metrics can vary by around 20%, although the model without random resampling consistently performed worse than the model that did implement random resampling on all accounts. Randomness in the results can also be attributed to the particular selection of data that is chosen for the training, since some data points may be better training examples than others. These results supplement the existing body of research that upsampling is a valid way to augment data sets.
## Summary and Conclusion:
> In summary, the ANN utilizing random resampling provides a good predictor on the expected 5 year survival rate of patients with HNSCC based upon the clinical features chosen for the given population. It also demonstrates that body composition before and after treatment can be used to predict the survival rate of patients with HNSCC. Further research can be done to determine what additional clinical features can be used as indicators as well. Additionally, models that make use of image data with Convolutional Neural Networks (CNNs) can be used to supplement models that use clinical features alone, although that particular research problem was not within the scope of this project. Additionally, more data sets can be used for both the training and testing partitions in order to provide a more diversified, robust sample population.
## References:
[1] Head and neck squamous cell carcinoma. (2020, August 18). Medline. https://medlineplus.gov/genetics/condition/head-and-neck-squamous-cell-carcinoma/
[2] Union for International Cancer Control. (2014). Locally Advanced Squamous Carcinoma of the Head and Neck. Review of Cancer Medicines on the WHO List of Essential Medicines, 1–8. https://www.who.int/selection_medicines/committees/expert/20/applications/cancer/en/

[3] Grossberg A, Mohamed A, Elhalawani H, Bennett W, Smith K, Nolan T, Williams B, Chamchod S, Heukelom J, Kantor M, Browne T, Hutcheson K, Gunn G, Garden A, Morrison W, Frank S, R osenthal D, Freymann J, Fuller C. (2018) Imaging and Clinical Data Archive for Head and Neck Squamous Cell Carcinoma Patients Treated with Radiotherapy. Scientific Data 5 :180173 (2018) DOI: 10.1038/sdata.2018.173 
[4] Zheng Chen, Meng Pang, Zixin Zhao, Shuainan Li, Rui Miao, Yifan Zhang, Xiaoyue Feng, Xin Feng, Yexian Zhang, Meiyu Duan, Lan Huang, Fengfeng Zhou, Feature selection may improve deep neural networks for the bioinformatics problems, Bioinformatics, Volume 36, Issue 5, March 2020, Pages 1542–1552, https://doi.org/10.1093/bioinformatics/btz763
[5] Forghani R, Chatterjee A, Reinhold C, Pérez-Lara A, Romero-Sanchez G, Ueno Y, Bayat M, Alexander JWM, Kadi L, Chankowsky J, Seuntjens J, Forghani B. Head and neck squamous cell carcinoma: prediction of cervical lymph node metastasis by dual-energy CT texture analysis with machine learning. Eur Radiol. 2019 Nov;29(11):6172-6181. doi: 10.1007/s00330-019-06159-y. Epub 2019 Apr 12. PMID: 30980127.

[6] D. R. Cox, “Regression models and life-tables,” Journal of the Royal Statistical Society. Series B (Methodological), vol.34, no.2, pp.187–220, 1972. [Online]. Available: http://www.jstor.org/stable/2985181

[7] Sayantani Ghosh, Shaurav Maulik, Sanjoy Chatterjee, Indranil Mallick, Nishant Chakravorty, Jayanta Mukherjee, Prediction of survival outcome based on clinical features and pretreatment 18FDG-PET/CT for HNSCC patients, Computer Methods and Programs in Biomedicine, Volume 195, 2020, 105669, ISSN 0169-2607, https://doi.org/10.1016/j.cmpb.2020.105669.

[8] Sebastian Klein, Alexander Quaas, Jennifer Quantius, Heike Löser, Jörn Meinel, Martin Peifer, Steffen Wagner, Stefan Gattenlöhner, Claus Wittekindt, Magnus von Knebel Doeberitz, Elena-Sophie Prigge, Christine Langer, Ka-Won Noh, Margaret Maltseva, Hans Christian Reinhardt, Reinhard Büttner, Jens Peter Klussmann and Nora Wuerdemann, Deep Learning Predicts HPV Association in Oropharyngeal Squamous Cell Carcinomas and Identifies Patients with a Favorable Prognosis Using Regular H&E Stains. Clin Cancer Res February 15 2021 (27) (4) 1131-1138; DOI: 10.1158/1078-0432.CCR-20-3596 

[9] Farzaneh Farshadpour MD, Hanneke Kranenborg MD, Eveline Van Beeck Calkoen MD, Gerrit, Jan Hordijk MD, PhD, Ron Koole MD, PhD, Piet J. Slootweg MD, PhD, Chris H. Terhaard MD, PhD. Survival analysis of head and neck squamous cell carcinoma: Influence of smoking and drinking. Journal of the Sciences and Specialties of the Head and Neck. 24 Aug. 2010. https://doi.org/10.1002/hed.21549

[10] Francisco Charte, Antonio J. Rivera, María J. del Jesus, Francisco Herrera, Addressing imbalance in multilabel classification: Measures and random resampling algorithms, Neurocomputing, Volume 163, 2015, Pages 3-16, ISSN 0925-2312, https://doi.org/10.1016/j.neucom.2014.08.091.
